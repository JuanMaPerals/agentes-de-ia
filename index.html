<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IA Agent Hub - Juan Ma Perals</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <aside id="sidebar">
    <h1>Agent Hub</h1>
    <ul id="nav-menu">
      <li><a href="#" data-target="intro">Bienvenida</a></li>
      <li><a href="#" data-target="quiz">Generar Quiz</a></li>
      <li><a href="#" data-target="plan">Generar Plan</a></li>
      <li><a href="#" data-target="explicador">Explicador de CÃ³digo</a></li>
      <li>
        <a href="#" class="nav-section-title">Bloques Extra</a>
        <ul class="submenu">
          <li><a href="#" data-target="bloque1-n8n">N8N y automatizaciÃ³n</a></li>
          <li><a href="#" data-target="bloque1-n8n-llama">N8N + llama-index</a></li>
          <li><a href="#" data-target="bloque2-tools">Agente con @tools</a></li>
        </ul>
      </li>
      <li><a href="#" data-target="tts">Text-to-Speech</a></li>
    </ul>
  </aside>

  <main id="content-pane">
    <section id="intro" class="content-section active">
      <h2>Bienvenida</h2>
      <p>Â¡Bienvenido al Hub de Agentes IA de Juan Ma Perals!</p>
    </section>

    <section id="quiz" class="content-section">
      <h2>âœ¨ Generar Quiz</h2>
      <textarea id="quiz-input" placeholder="Temaâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="quiz-btn">Generar Quiz</button>
      <div id="quiz-output" class="lab-output"></div>
    </section>

    <section id="plan" class="content-section">
      <h2>ðŸ“Œ Generar Plan</h2>
      <textarea id="plan-input" placeholder="Tema del planâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="plan-btn">Generar Plan</button>
      <div id="plan-output" class="lab-output"></div>
    </section>

    <section id="explicador" class="content-section">
      <h2>ðŸ’» Explicador de CÃ³digo</h2>
      <textarea id="explicador-input" placeholder="Pega tu cÃ³digoâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="explicador-btn">Explicar</button>
      <div id="explicador-output" class="lab-output"></div>
    </section>

    <section id="bloque1-n8n" class="content-section">
      <h2>BLOQUE 1: N8N</h2>
      <textarea id="bloque1-n8n-input" placeholder="Pregunta sobre N8Nâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="bloque1-n8n-btn">Responder</button>
      <div id="bloque1-n8n-output" class="lab-output"></div>
    </section>

    <section id="bloque1-n8n-llama" class="content-section">
      <h2>BLOQUE 1: N8N + llama-index</h2>
      <textarea id="bloque1-n8n-llama-input" placeholder="Preguntaâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="bloque1-n8n-llama-btn">Responder</button>
      <div id="bloque1-n8n-llama-output" class="lab-output"></div>
    </section>

    <section id="bloque2-tools" class="content-section">
      <h2>BLOQUE 2: Agentes con @tools</h2>
      <textarea id="bloque2-tools-input" placeholder="Preguntaâ€¦" style="width:100%;height:120px;"></textarea>
      <button id="bloque2-tools-btn">Responder</button>
      <div id="bloque2-tools-output" class="lab-output"></div>
    </section>

    <section id="tts" class="content-section">
      <h2>ðŸ”Š Text-to-Speech</h2>
      <textarea id="tts-input" placeholder="Texto a leerâ€¦" style="width:100%;height:120px;"></textarea>

      <label for="tts-voice">Voz:</label>
      <select id="tts-voice">
        <option value="es-male">EspaÃ±ol - Masculino</option>
        <option value="es-female">EspaÃ±ol - Femenino</option>
        <option value="en-male">InglÃ©s - Masculino</option>
        <option value="en-female">InglÃ©s - Femenino</option>
      </select>

      <label for="tts-rate">Velocidad:</label>
      <input type="number" id="tts-rate" value="1.0" min="0.5" max="2" step="0.1">

      <button id="tts-btn">Generar Audio</button>
      <div id="tts-output" class="lab-output"></div>
      <audio id="tts-audio" controls style="margin-top:1rem; display:none;"></audio>
    </section>
  </main>

  <script>
  const ApiController = {
    async callGemini(payload, model = "gemini-2.5-flash-preview-05-20") {
      try {
        const response = await fetch("/api/generateGemini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ payload, model }),
        });
        if (!response.ok) throw new Error("Error en la API");
        return await response.json();
      } catch (err) {
        console.error(err);
        return { error: err.message };
      }
    }
  };

  // NavegaciÃ³n
  document.querySelectorAll('#nav-menu a[data-target]').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const target = link.getAttribute('data-target');
      document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(target).classList.add('active');
    });
  });

  async function runBlock(inputId, outputId, prompt) {
    const input = document.getElementById(inputId).value.trim();
    const output = document.getElementById(outputId);
    if (!input) return output.textContent = "Por favor, escribe algo.";
    output.textContent = "Generando respuestaâ€¦";
    const payload = {
      contents: [{ parts: [{ text: input }] }],
      systemInstruction: { parts: [{ text: prompt }] }
    };
    const result = await ApiController.callGemini(payload);
    output.textContent = result.error || result.candidates?.[0]?.content?.parts?.[0]?.text || "Sin respuesta.";
  }

  // Botones
  document.getElementById("quiz-btn").addEventListener("click", () =>
    runBlock("quiz-input", "quiz-output", "Genera un quiz educativo de 5 preguntas."));
  document.getElementById("plan-btn").addEventListener("click", () =>
    runBlock("plan-input", "plan-output", "Haz un plan de estudio claro y directo."));
  document.getElementById("explicador-btn").addEventListener("click", () =>
    runBlock("explicador-input", "explicador-output", "Explica este cÃ³digo paso a paso."));
  document.getElementById("bloque1-n8n-btn").addEventListener("click", () =>
    runBlock("bloque1-n8n-input", "bloque1-n8n-output", "Responde como experto en n8n y automatizaciÃ³n."));
  document.getElementById("bloque1-n8n-llama-btn").addEventListener("click", () =>
    runBlock("bloque1-n8n-llama-input", "bloque1-n8n-llama-output", "Explica N8N con llama-index y MCP/A2A."));
  document.getElementById("bloque2-tools-btn").addEventListener("click", () =>
    runBlock("bloque2-tools-input", "bloque2-tools-output", "Responde como experto en agentes con @tools."));

  // TTS
  document.getElementById("tts-btn").addEventListener("click", async () => {
    const text = document.getElementById("tts-input").value.trim();
    const voiceSel = document.getElementById("tts-voice").value;
    const rate = parseFloat(document.getElementById("tts-rate").value);
    const output = document.getElementById("tts-output");
    const audioEl = document.getElementById("tts-audio");

    if (!text) return output.textContent = "Por favor, escribe un texto.";
    output.textContent = "Generando audioâ€¦";

    const [lang, gender] = voiceSel.split("-");
    const payload = {
      contents: [{ parts: [{ text }] }],
      generationConfig: {
        audioConfig: {
          languageCode: lang === "es" ? "es-ES" : "en-US",
          voice: gender,
          speakingRate: rate
        }
      }
    };

    const result = await ApiController.callGemini(payload, "gemini-2.0-flash-lite-audio");
    if (result.error) {
      output.textContent = `Error: ${result.error}`;
    } else {
      const audioData = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
      if (audioData) {
        audioEl.src = "data:audio/wav;base64," + audioData;
        audioEl.style.display = "block";
        output.textContent = "âœ… Audio generado";
      } else {
        output.textContent = "No se generÃ³ audio.";
      }
    }
  });
  </script>
</body>
</html>
